<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ê∂à„Åó„Ç¥„É†„Çì„Åü„Çç„ÅÜ ÂÖ¨Âºè„Çµ„Ç§„Éà</title>
    <style>
        body { background-color: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; overflow: hidden; }
        #profile { padding: 20px; background: linear-gradient(180deg, #222, #000); border-bottom: 2px solid #444; }
        h1 { color: #ffeb3b; margin: 0; font-size: 24px; text-shadow: 2px 2px #f44336; }
        .sub-text { font-size: 14px; color: #bbb; }
        
        /* „Ç≤„Éº„É†ÁîªÈù¢ */
        #game-container { position: relative; width: 100vw; height: 50vh; background: #111; touch-action: none; overflow: hidden; }
        #player { position: absolute; bottom: 10px; width: 50px; height: 50px; background: #fff; border-radius: 5px; border: 2px solid #aaa; font-size: 30px; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .dust { position: absolute; font-size: 20px; }
        
        /* „ÇØ„É™„ÉÉ„Ç´„Éº/UI */
        #ui-layer { padding: 10px; display: flex; justify-content: space-around; align-items: center; background: #222; }
        #fever-btn { padding: 10px 20px; background: #f44336; border: none; color: #fff; font-weight: bold; border-radius: 20px; display: none; box-shadow: 0 0 15px #f44336; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* „É©„É≥„Ç≠„É≥„Ç∞ */
        #ranking-section { height: 30vh; overflow-y: auto; background: #000; padding: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { border-bottom: 1px solid #444; color: #ffeb3b; }
        td { padding: 5px; border-bottom: 1px solid #222; }
        .new-mark { background: #f44336; color: #fff; font-size: 10px; padding: 2px 5px; border-radius: 5px; margin-left: 5px; }
    </style>
</head>
<body>

<div id="profile">
    <h1>Ê∂à„Åó„Ç¥„É†„Çì„Åü„Çç„ÅÜ ÂÖ¨Âºè</h1>
    <p class="sub-text">ÈñìÈÅï„Åà„Åü„Å£„Å¶Â§ß‰∏àÂ§´„ÄÇÊ∂à„Åó„Å¶„ÇÑ„ÇäÁõ¥„Åõ„Å∞„ÅÑ„ÅÑ„Çì„Å†„ÄÇ</p>
</div>

<div id="ui-layer">
    <div>SCORE: <span id="score">0</span></div>
    <button id="fever-btn" onclick="startFever()">FEVER!! „Çø„ÉÉ„Éó!</button>
    <div>LIFE: <span id="life">‚ù§‚ù§‚ù§</span></div>
</div>

<div id="game-container" id="game-area">
    <div id="player">‚¨ú</div>
</div>

<div id="ranking-section">
    <h3>üèÜ ‰ªäÊó•„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞ (ÊúÄÊñ∞È†Ü)</h3>
    <table id="ranking-table">
        <thead><tr><th>È†Ü‰Ωç</th><th>ÂêçÂâç</th><th>„Çπ„Ç≥„Ç¢</th></tr></thead>
        <tbody id="ranking-body"></tbody>
    </table>
</div>

<script>
    const player = document.getElementById('player');
    const container = document.getElementById('game-container');
    const scoreDisp = document.getElementById('score');
    const lifeDisp = document.getElementById('life');
    const feverBtn = document.getElementById('fever-btn');
    
    let score = 0;
    let life = 3;
    let isFever = false;
    let playerX = window.innerWidth / 2 - 25;
    const ngWords = ["Ê≠ª„Å≠", "ÊÆ∫„Åô", "„ÅÜ„Çì„Åì", "„Å°„Çì„Åì", "„Åæ„Çì„Åì", "„Åä„Å£„Å±„ÅÑ", "„Çª„ÉÉ„ÇØ„Çπ", "69"]; // ÂøÖË¶Å„Å´Âøú„Åò„Å¶ËøΩÂä†

    // „Éó„É¨„Ç§„É§„ÉºÁßªÂãïÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
    container.addEventListener('touchmove', (e) => {
        let touchX = e.touches[0].clientX;
        playerX = touchX - 25;
        if (playerX < 0) playerX = 0;
        if (playerX > window.innerWidth - 50) playerX = window.innerWidth - 50;
        player.style.left = playerX + 'px';
    });

    // Ê∂à„Åó„Ç´„ÇπÁîüÊàê
    function createDust() {
        if (life <= 0) return;
        const dust = document.createElement('div');
        dust.className = 'dust';
        dust.style.left = Math.random() * (window.innerWidth - 20) + 'px';
        dust.style.top = '-20px';
        
        const isBonus = Math.random() < 0.1;
        const isEnemy = !isBonus && Math.random() < 0.15;
        
        dust.innerText = isBonus ? '‚≠ê' : (isEnemy ? 'üí£' : '‚òÅÔ∏è');
        container.appendChild(dust);

        let speed = isFever ? 8 : (3 + score / 500);
        let interval = setInterval(() => {
            let top = parseInt(dust.style.top);
            if (top > container.clientHeight) {
                if (!isBonus && !isEnemy && !isFever) {
                    life--;
                    updateLife();
                }
                clearInterval(interval);
                dust.remove();
            } else {
                dust.style.top = (top + speed) + 'px';
                // ÂΩì„Åü„ÇäÂà§ÂÆö
                let dustRect = dust.getBoundingClientRect();
                let playerRect = player.getBoundingClientRect();
                if (dustRect.top < playerRect.bottom && dustRect.bottom > playerRect.top &&
                    dustRect.left < playerRect.right && dustRect.right > playerRect.left) {
                    
                    if (isEnemy) {
                        life--;
                        updateLife();
                    } else {
                        score += isBonus ? 50 : 10;
                        if (score % 100 === 0) feverBtn.style.display = 'block';
                    }
                    scoreDisp.innerText = score;
                    clearInterval(interval);
                    dust.remove();
                }
            }
        }, 20);
    }

    function updateLife() {
        lifeDisp.innerText = "‚ù§".repeat(Math.max(0, life));
        if (life <= 0) {
            const name = prompt(`„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÔºÅ„Çπ„Ç≥„Ç¢: ${score}\nÂêçÂâç„ÇíÂÖ•„Çå„Å¶„Å≠Ôºà‰∏ã„Éç„ÇøÁ¶ÅÊ≠¢Ôºâ`);
            saveScore(name || "ÂêçÁÑ°„Åó„Çì„Åü„Çç„ÅÜ", score);
            location.reload();
        }
    }

    function startFever() {
        isFever = true;
        feverBtn.style.display = 'none';
        container.style.background = '#331100';
        setTimeout(() => {
            isFever = false;
            container.style.background = '#111';
        }, 5000);
    }

    // „É©„É≥„Ç≠„É≥„Ç∞Âá¶ÁêÜÔºà„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏ÁâàÔºöÊúÄÊñ∞È†Ü„Å´„ÇΩ„Éº„ÉàÔºâ
    function saveScore(name, score) {
        let cleanName = name;
        ngWords.forEach(word => {
            if (cleanName.includes(word)) cleanName = "„Åç„Çå„ÅÑ„Å™„Çì„Åü„Çç„ÅÜ";
        });

        let ranks = JSON.parse(localStorage.getItem('ntaro_rank') || "[]");
        ranks.push({ name: cleanName, score: score, date: Date.now() });
        // „Çπ„Ç≥„Ç¢È†Ü„ÄÅÂêåÁÇπ„Å™„ÇâÊó•‰ªò„ÅåÊñ∞„Åó„ÅÑÔºàÊï∞ÂÄ§„ÅåÂ§ß„Åç„ÅÑÔºâÈ†Ü
        ranks.sort((a, b) => b.score - a.score || b.date - a.date);
        localStorage.setItem('ntaro_rank', JSON.stringify(ranks.slice(0, 10)));
    }

    function showRanking() {
        let ranks = JSON.parse(localStorage.getItem('ntaro_rank') || "[]");
        const body = document.getElementById('ranking-body');
        body.innerHTML = ranks.map((r, i) => `
            <tr>
                <td>${i+1}</td>
                <td>${r.name}${ (Date.now() - r.date < 60000) ? '<span class="new-mark">NEW</span>' : '' }</td>
                <td>${r.score}</td>
            </tr>
        `).join('');
    }

    setInterval(createDust, 1000);
    showRanking();
</script>
</body>
</html>
